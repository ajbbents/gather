{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Alison/Documents/CareerFoundry/Immersion/Achievement4/meet/meet/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Alison/Documents/CareerFoundry/Immersion/Achievement4/meet/meet/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"C:/Users/Alison/Documents/CareerFoundry/Immersion/Achievement4/meet/meet/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";/* @param {*} events:\r\n * The following function should be in the “api.js” file.\r\n * This function takes an events array, then uses map to create a new array with only locations.\r\n * It will also remove all duplicates by creating another new array using the spread operator and spreading a Set.\r\n * The Set will remove all duplicates from the array.\r\n */import{mockData}from\"./mock-data\";import axios from\"axios\";import NProgress from'nprogress';export var extractLocations=function extractLocations(events){var extractLocations=events.map(function(event){return event.location;});var locations=_toConsumableArray(new Set(extractLocations));return locations;};var checkToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(accessToken){var result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=\".concat(accessToken)).then(function(res){return res.json();}).catch(function(error){return error.json();});case 2:result=_context.sent;return _context.abrupt(\"return\",result);case 4:case\"end\":return _context.stop();}},_callee);}));return function checkToken(_x){return _ref.apply(this,arguments);};}();export var getEvents=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var token,url,result,locations;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:NProgress.start();if(!window.location.href.startsWith('http://localhost')){_context2.next=4;break;}NProgress.done();return _context2.abrupt(\"return\",mockData);case 4:_context2.next=6;return getAccessToken();case 6:token=_context2.sent;if(!token){_context2.next=16;break;}removeQuery();url='https://h3dqhxwslk.execute-api.us-east-2.amazonaws.com/dev/api/get-events'+'/'+token;_context2.next=12;return axios.get(url);case 12:result=_context2.sent;if(result.data){locations=extractLocations(result.data.events);localStorage.setItem(\"lastEvents\",JSON.stringify(result.data));localStorage.setItem(\"locations\",JSON.stringify(locations));}NProgress.done();return _context2.abrupt(\"return\",result.data.events);case 16:case\"end\":return _context2.stop();}},_callee2);}));return function getEvents(){return _ref2.apply(this,arguments);};}();export var getAccessToken=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var accessToken,tokenCheck,searchParams,code,results,authUrl;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:accessToken=localStorage.getItem('access_token');_context3.t0=accessToken;if(!_context3.t0){_context3.next=6;break;}_context3.next=5;return checkToken(accessToken);case 5:_context3.t0=_context3.sent;case 6:tokenCheck=_context3.t0;if(!(!accessToken||tokenCheck.error)){_context3.next=21;break;}_context3.next=10;return localStorage.removeItem(\"access_token\");case 10:searchParams=new URLSearchParams(window.location.search);_context3.next=13;return searchParams.get(\"code\");case 13:code=_context3.sent;if(code){_context3.next=20;break;}_context3.next=17;return axios.get(\"https://h3dqhxwslk.execute-api.us-east-2.amazonaws.com/dev/api/get-auth-url\");case 17:results=_context3.sent;authUrl=results.data.authUrl;return _context3.abrupt(\"return\",window.location.href=authUrl);case 20:return _context3.abrupt(\"return\",code&&getAccessToken(code));case 21:return _context3.abrupt(\"return\",accessToken);case 22:case\"end\":return _context3.stop();}},_callee3);}));return function getAccessToken(){return _ref3.apply(this,arguments);};}();var removeQuery=function removeQuery(){if(window.history.pushState&&window.location.pathname){var newurl=window.location.protocol+\"//\"+window.location.host+window.location.pathname;window.history.pushState(\"\",\"\",newurl);}else{newurl=window.location.protocol+\"//\"+window.location.host;window.history.pushState(\"\",\"\",newurl);}};var getToken=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(code){var encodeCode,_yield$fetch$then$cat,access_token;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:encodeCode=encodeURIComponent(code);_context4.next=3;return fetch('https://h3dqhxwslk.execute-api.us-east-2.amazonaws.com/dev/api/token'+'/'+encodeCode).then(function(res){return res.json();}).catch(function(error){return error;});case 3:_yield$fetch$then$cat=_context4.sent;access_token=_yield$fetch$then$cat.access_token;access_token&&localStorage.setItem(\"access_token\",access_token);return _context4.abrupt(\"return\",access_token);case 7:case\"end\":return _context4.stop();}},_callee4);}));return function getToken(_x2){return _ref4.apply(this,arguments);};}();","map":{"version":3,"names":["mockData","axios","NProgress","extractLocations","events","map","event","location","locations","_toConsumableArray","Set","checkToken","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","accessToken","result","wrap","_callee$","_context","prev","next","fetch","concat","then","res","json","catch","error","sent","abrupt","stop","_x","apply","arguments","getEvents","_ref2","_callee2","token","url","_callee2$","_context2","start","window","href","startsWith","done","getAccessToken","removeQuery","get","data","localStorage","setItem","JSON","stringify","_ref3","_callee3","tokenCheck","searchParams","code","results","authUrl","_callee3$","_context3","getItem","t0","removeItem","URLSearchParams","search","history","pushState","pathname","newurl","protocol","host","getToken","_ref4","_callee4","encodeCode","_yield$fetch$then$cat","access_token","_callee4$","_context4","encodeURIComponent","_x2"],"sources":["C:/Users/Alison/Documents/CareerFoundry/Immersion/Achievement4/meet/meet/src/api.js"],"sourcesContent":["/* @param {*} events:\r\n * The following function should be in the “api.js” file.\r\n * This function takes an events array, then uses map to create a new array with only locations.\r\n * It will also remove all duplicates by creating another new array using the spread operator and spreading a Set.\r\n * The Set will remove all duplicates from the array.\r\n */\r\nimport { mockData } from \"./mock-data\";\r\nimport axios from \"axios\";\r\nimport NProgress from 'nprogress';\r\n\r\nexport const extractLocations = (events) => {\r\n  var extractLocations = events.map((event) => event.location);\r\n  var locations = [...new Set(extractLocations)];\r\n  return locations;\r\n};\r\n\r\nconst checkToken = async (accessToken) => {\r\n  const result = await fetch(\r\n    `https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=${accessToken}`\r\n  )\r\n    .then((res) => res.json())\r\n    .catch((error) => error.json());\r\n\r\n  return result;\r\n}\r\n\r\nexport const getEvents = async () => {\r\n  NProgress.start();\r\n\r\n  if (window.location.href.startsWith('http://localhost')) {\r\n    NProgress.done();\r\n    return mockData;\r\n  }\r\n\r\n  const token = await getAccessToken();\r\n  if (token) {\r\n    removeQuery();\r\n    const url = 'https://h3dqhxwslk.execute-api.us-east-2.amazonaws.com/dev/api/get-events' + '/' + token;\r\n    const result = await axios.get(url);\r\n    if (result.data) {\r\n      var locations = extractLocations(result.data.events);\r\n      localStorage.setItem(\"lastEvents\", JSON.stringify(result.data));\r\n      localStorage.setItem(\"locations\", JSON.stringify(locations));\r\n    }\r\n    NProgress.done();\r\n    return result.data.events;\r\n  }\r\n};\r\n\r\nexport const getAccessToken = async () => {\r\n  const accessToken = localStorage.getItem('access_token');\r\n  const tokenCheck = accessToken && (await checkToken(accessToken));\r\n\r\n  if (!accessToken || tokenCheck.error) {\r\n    await localStorage.removeItem(\"access_token\");\r\n    const searchParams = new URLSearchParams(window.location.search);\r\n    const code = await searchParams.get(\"code\");\r\n    if (!code) {\r\n      const results = await axios.get(\r\n        \"https://h3dqhxwslk.execute-api.us-east-2.amazonaws.com/dev/api/get-auth-url\"\r\n      );\r\n      const { authUrl } = results.data;\r\n      return (window.location.href = authUrl);\r\n    }\r\n    return code && getAccessToken(code);\r\n  }\r\n  return accessToken;\r\n};\r\n\r\nconst removeQuery = () => {\r\n  if (window.history.pushState && window.location.pathname) {\r\n    var newurl =\r\n      window.location.protocol +\r\n      \"//\" +\r\n      window.location.host +\r\n      window.location.pathname;\r\n    window.history.pushState(\"\", \"\", newurl);\r\n  } else {\r\n    newurl = window.location.protocol + \"//\" + window.location.host;\r\n    window.history.pushState(\"\", \"\", newurl);\r\n  }\r\n};\r\n\r\nconst getToken = async (code) => {\r\n  const encodeCode = encodeURIComponent(code);\r\n  const { access_token } = await fetch(\r\n    'https://h3dqhxwslk.execute-api.us-east-2.amazonaws.com/dev/api/token' + '/' + encodeCode\r\n  )\r\n    .then((res) => {\r\n      return res.json();\r\n    })\r\n    .catch((error) => error);\r\n\r\n  access_token && localStorage.setItem(\"access_token\", access_token);\r\n\r\n  return access_token;\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}